<article id="technical" title="Technical Information">
   <h1>Technical Information</h1>

   <p>Saxon/C is built by cross compiling the Java code of Saxon 9.9.1.5 using the Excelsior JET
      15.3 Enterprise edition (MP1). This generates platform specific machine code, which we
      interface with C/C++ using the Java Native Interace (JNI).</p>

   <p><b>Embedded systems</b>: It is also possible to build Saxon/C for embedded systems, for
      example on a Linux/ARM System. If such a build is required please contact Saxonica to discuss
      further: <a href="mailto:support@saxonica.com">support@saxonica.com</a>.</p>

   <p>The PHP interface is in the form of a C/C++ PHP extension to Saxon/C created using the Zend
      module API. Supports PHP5 and PHP7.</p>

   <p>The Python interface is in the form of a Cython module interfaced with the C/C++ Saxon/C API.
      Currently supports Python3.</p>

   <p>The XML parser used is the one supplied by the Excelsior JET runtime which is cross compiled
      from the openJDK 8u181. There are currently no links to libxml.</p>



   <h2>Limitations</h2>

   <p>The following limitations apply to the 1.2.1 release:</p>
   <ul>
      <li>No support for the XDM function type in the XDM data model.</li>
      <li>The bytecode generation feature available in Saxon-EE on Java is not available in
         Saxon-EE/C.</li>
      <li>It is currently not possible to create and export to file a precompiled schema component
         model (SCM).</li>
   </ul>

   <h2>Feedback/Comments:</h2>

   <p>Please use the help forums and bug trackers for Saxon/C at <a
         href="https://saxonica.plan.io/projects/saxon-c" target="_blank">saxonica.plan.io</a> if
      you need help or advice. Or send email to <a href="mailto:support@saxonica.com"
         >support@saxonica.com</a>.</p>


    <section id="debugging" title="Debugging">
        <h1>Debuggin</h1>

        <p>Exceptions and errors are captured and maintained silently in Saxon/C, but can be accessed. This is due to the restrictions in JNI: "There is no uniform and general
            way to throw and catch exceptions in native languages compared to Java. The JNI therefore requires you to check for possible
                    exceptions after
                    calling JNI functions". <br/><br/>Any exceptions or errors found in a Saxon/C method can be retrieved
                    by the method call 'getErrorMessage(<i>n</i>)', where <i>n</i> is an index number
                    referring to the <i>n</i>th error message.
                    The method getErrorCount() gets the total number of errors reported, which helps to
                    loop through the errors if there are more than one of them. Please see the following PHP code snippet:</p>

                <pre class="codeblock"><![CDATA[<?php
            ...
            $result = $query->runQueryToString();
            if($result == NULL) {
                $errCount = $query->getExceptionCount();
                if($errCount > 0 ){
                    for ($i = 0; $i &lt; $errCount; $i++) {
                        $errC = $query->getErrorCode(intval(i));
                        $errMessage = $query->getErrorMessage(intval(i));
                        if($errC != NULL) {
                            echo 'Error found: '. $errC.' :'.$errMessage;
                        }
                        $query->exceptionClear();
                    }
                }
            }
            ...
        ?>]]></pre>

    </section>

    <section id="troubleshooting" title="Troubleshooting">
        <h1>Troubleshooting</h1>

        <p>After installing Saxon/C, if you notice anomalies in execution then the apache log file usually has useful information on errors
                    reported and crashes. We try to best describe some of the common errors and crashes, and their solutions, below: </p>
                <ul>
                    <li>
                        <p><code>FATAL ERROR: Unable to load /usr/lib64/rt/lib/amd64/libjava.so (libjvm.so cannot open shared object file:
                            No such file or directory) JNI_CreateJavaVM() failed with result-1</code>    </p>
                        <i>Solution:</i>
                        Run the following command should resolve the error: "$ sudo ldconfig".
                        Alternatively create a symlink to java virtual machine. This is not required to install/compile,
                        but it is required for PHP code.
                        The following should resolve the issue on a 64-bit machine:
                        <code><br/>ln -s  $JAVA_HOME/jre/lib/amd64/server/libjvm.so /lib64/libjvm.so<br/></code>
                        Alternatively, it is possible to link the libjvm.so from the rt/lib/jetjvm directory.
                    </li>
                    <li>
                        <p><code>/usr/lib/Saxon-C-API/SaxonProcessor.h:3:17: fatal error: jni.h: No such
                            file or directory <br/>#include &lt;jni.h&gt; compilation terminated.</code></p>
                        <i>Solution:</i>
                        Link the jni.h on the machine or simply install gcj-jdk which should resolve this error.
                    </li>
                    <li>
                        <p><code>PHP Warning:  PHP Startup: Unable to load dynamic library
                            '/usr/lib/php/modules/saxon.so' - libsaxonhec.so: cannot enable executable
                            stack as shared object requires: Permission denied in Unknown on line 0</code>
                        </p>
                        <i>Solution:</i>
                        Observed this on centos systems: SELinux is enforced/enabled<br/>
                        Run the command: "ls -alZ /usr/lib" and  'ls -alZ /usr/lib/php/module/"<br/>
                        This is to show up the security setting for the library files. Run the following
                        commands or similar to change the security context:<br/>
                        chcon system_u:object_r:lib_t:s0 /usr/lib/libsaxonhec.so<br/>
                        chcon system_u:object_r:lib_t:s0 /usr/lib/php/modules/saxon.so

                    </li>
                    <li>
                        <p>Some 64-bit Linux flavors do not run the 32-bit JET libraries by default.</p>
                        <i>Solution:</i>
                        For instance, <code>ia32-libs</code> must be installed on Ubuntu/Debian, using:<br/>
                        <code>sudo apt-get install ia32-libs</code>
                    </li>
                </ul>


    </section>

</article>
